<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Assignment - Assignment Evaluator</title>
    <link rel="stylesheet" href="../css/style.css">
</head>

<body>
    <div class="portal-wrapper">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">üë©‚Äçüè´ AES Teacher</div>
            </div>
            <nav class="sidebar-nav">
                <a href="dashboard.html" class="nav-item">
                    <span class="nav-icon">üìä</span>
                    <span>Dashboard</span>
                </a>
                <a href="create-assignment.html" class="nav-item active">
                    <span class="nav-icon">‚ûï</span>
                    <span>Create Assignment</span>
                </a>
                <a href="submissions.html" class="nav-item">
                    <span class="nav-icon">üì•</span>
                    <span>Submissions</span>
                </a>
                <a href="profile.html" class="nav-item">
                    <span class="nav-icon">üë§</span>
                    <span>Profile</span>
                </a>
            </nav>
        </aside>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Top Navbar -->
            <nav class="navbar">
                <h2 class="navbar-title">Create Assignment</h2>
                <div class="navbar-right">
                    <div class="user-info">
                        <span class="user-avatar" id="navAvatar" style="width: 40px; height: 40px; border-radius: 50%; background: var(--primary-blue); color: white; display: inline-flex; align-items: center; justify-content: center; font-weight: 600;">--</span>
                        <span class="user-name" id="navUserName">Teacher</span>
                    </div>
                    <a href="../index.html" class="btn btn-sm btn-secondary">Logout</a>
                </div>
            </nav>

            <!-- Content Area -->
            <div class="content-area">
                <div class="page-header">
                    <h1 class="page-title">Create New Assignment</h1>
                    <p class="page-subtitle">Fill in the details to create a new assignment</p>
                </div>

                <div class="card">
                    <div class="card-body">
                        <form>
                            <div class="form-group">
                                <label class="form-label" for="assignment-title">Assignment Title *</label>
                                <input type="text" id="assignment-title" class="form-input"
                                    placeholder="e.g., Data Structures - Assignment 4" required>
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="subject">Subject *</label>
                                <select id="subject" class="form-select" required>
                                    <option value="">Select a subject</option>
                                    <option value="cs">Computer Science</option>
                                    <option value="it">Information Technology</option>
                                    <option value="ai">Artificial Intelligence</option>
                                    <option value="is">Information Security</option>
                                    <option value="ds">Data Science</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="description">Description (Optional)</label>
                                <textarea id="description" class="form-textarea"
                                    placeholder="Provide detailed instructions for the assignment..." rows="6"></textarea>
                            </div>

                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--spacing-md);">
                                <div class="form-group">
                                    <label class="form-label" for="deadline-date">Deadline Date *</label>
                                    <input type="date" id="deadline-date" class="form-input" required>
                                </div>

                                <div class="form-group">
                                    <label class="form-label" for="deadline-time">Deadline Time *</label>
                                    <input type="time" id="deadline-time" class="form-input" value="23:59" required>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="max-marks">Maximum Marks *</label>
                                <input type="number" id="max-marks" class="form-input" placeholder="100" min="1"
                                    required>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Upload Question Paper (Required) *</label>
                                <div class="form-file" id="fileDropZone" style="cursor: pointer;">
                                    <div class="form-file-label" id="fileLabel">
                                        üìé Click to browse or drag and drop your file here
                                        <br>
                                        <small style="color: var(--text-light);">PDF, DOC, DOCX (Max 5MB)</small>
                                    </div>
                                    <input type="file" id="fileInput" accept=".pdf,.doc,.docx" style="display: none;">
                                </div>
                                <small id="fileError" style="color: var(--danger); display: none;">Please select a file.</small>
                            </div>

                            <div class="form-group">
                                <label
                                    style="display: flex; align-items: center; gap: var(--spacing-xs); cursor: pointer;">
                                    <input type="checkbox" checked>
                                    <span>Enable AI plagiarism detection</span>
                                </label>
                            </div>

                            <div class="alert alert-info">
                                <span>‚ÑπÔ∏è</span>
                                <div>
                                    <strong>Note:</strong> Students will be notified via email when the assignment is
                                    created.
                                    They can submit their work until the deadline.
                                </div>
                            </div>

                            <div class="flex gap-2 mt-3">
                                <button type="submit" class="btn btn-success" id="submitBtn">
                                    ‚úì Create Assignment
                                </button>
                                <a href="dashboard.html" class="btn btn-secondary">Cancel</a>
                            </div>
                            <div id="createAlert" style="display: none; margin-top: 1rem;" class="alert"></div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        (function(){
            var API_URL = "http://localhost:5000";
            var teacherId = sessionStorage.getItem("userId");
            var name = sessionStorage.getItem("userName") || teacherId || "Teacher";
            document.getElementById("navUserName").textContent = name;
            document.getElementById("navAvatar").textContent = (name && name.charAt(0).toUpperCase()) || "?";
            var fileInput = document.getElementById("fileInput");
            var fileLabel = document.getElementById("fileLabel");
            var fileDropZone = document.getElementById("fileDropZone");
            fileDropZone.onclick = function(){ fileInput.click(); };
            fileInput.onchange = function(){
                document.getElementById("fileError").style.display = "none";
                if (fileInput.files.length) fileLabel.innerHTML = "üìé " + fileInput.files[0].name + " <br><small>Click to change</small>";
            };
            document.querySelector("form").onsubmit = function(e){
                e.preventDefault();
                document.getElementById("createAlert").style.display = "none";
                var title = document.getElementById("assignment-title").value.trim();
                var subject = document.getElementById("subject").value;
                var subjectText = document.getElementById("subject").options[document.getElementById("subject").selectedIndex].text;
                var description = document.getElementById("description").value.trim();
                var date = document.getElementById("deadline-date").value;
                var time = document.getElementById("deadline-time").value || "23:59";
                var maxMarks = document.getElementById("max-marks").value.trim();
                if (!title){ showAlert("Please enter assignment title.", "error"); return; }
                if (!subject){ showAlert("Please select a subject.", "error"); return; }
                if (!date){ showAlert("Please select deadline date.", "error"); return; }
                if (!maxMarks || isNaN(parseInt(maxMarks, 10)) || parseInt(maxMarks, 10) < 1){ showAlert("Please enter valid maximum marks.", "error"); return; }
                if (!fileInput.files || fileInput.files.length === 0){ document.getElementById("fileError").style.display = "block"; showAlert("Please upload a question paper (PDF/DOC/DOCX).", "error"); return; }
                var deadline = date + " " + time + ":00";
                var fileUrl = fileInput.files[0].name;
                var btn = document.getElementById("submitBtn");
                btn.disabled = true;
                btn.textContent = "Creating...";
                fetch(API_URL + "/teacher/" + encodeURIComponent(teacherId) + "/assignments", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ title: title, subject: subjectText, description: description || null, deadline: deadline, max_marks: parseInt(maxMarks, 10), file_url: fileUrl })
                })
                .then(function(r){ return r.json(); })
                .then(function(data){
                    btn.disabled = false;
                    btn.textContent = "‚úì Create Assignment";
                    if (data.success){ showAlert("Assignment created successfully.", "success"); setTimeout(function(){ window.location.href = "dashboard.html"; }, 1200); }
                    else showAlert(data.message || "Failed to create assignment.", "error");
                })
                .catch(function(){
                    btn.disabled = false;
                    btn.textContent = "‚úì Create Assignment";
                    showAlert("Cannot connect to server.", "error");
                });
            };
            function showAlert(msg, type){
                var el = document.getElementById("createAlert");
                el.textContent = msg;
                el.className = "alert " + (type === "success" ? "alert-success" : "alert-danger");
                el.style.display = "block";
            }
        })();
    </script>
</body>

</html>